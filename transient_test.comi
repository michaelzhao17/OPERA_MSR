/ test script to try make time changing B field work
/ Jun 2024

$string yesorno YES
CLEAR REVERT=NO
THREED XORIGIN=0 YORIGIN=0 ZORIGIN=0 ROTX=0 ROTY=0 ROTZ=0 XASPECT=1 YASPECT=1 ZASPECT=1 SIZE=0 FACETANGLE=5 PERSPECTIVE=YES LINECOLOUR=YES OPTION=SETVIEW 

//// Perturbation Coil
// Build coil geometry
RACETRACK OPTION=LOAD
RACETRACK OPTION=NEW -KEEP XP1=2.75 YP1=-5.0E-03 WIDTH=0.01 THICKNESS=0.01 H1=2.75 R1=0.01 INCIRCUIT=NO CIRCUITELEMENT= CURD=88 TOLERANCE=0 DRIVELABEL='Perturbation' THETA2=0 PHI2=0 PSI2=0 XCEN2=0 YCEN2=0 ZCEN2=0 LCNAME='Global coordinate system' RXY=0 RYZ=0 RZX=0 SYMMETRY=1 MODELCOMPONENT=NO
// Set current, with scale factor to corrrect units
DRIVE UNPICK | DRIVE GUIINIT
DRIVE PICK 'Perturbation'
DRIVE OPTION=MODIFY TYPE=SINE SINFREQUENCY=0.1 SCALE=10000 | DRIVE UNPICK 


// create reduced airblock
SKETCH OBJECT=BLOCK +COMPLETE
BLOCK Name='Block' X0=3 Y0=1 Z0=3 X1=-3 Y1=-1 Z1=-3 MATERIALLABEL='Air' LEVEL=300
FILTER TYPE=BODY
PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Block'
PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Air' POTENTIAL=Reduced ELEMENTTYPE=Linear LEVEL=300 SIZE=0.1 ELEMSHAPEPREF=NONE

/ create total airblock
SKETCH OBJECT=BLOCK +COMPLETE
BLOCK Name='Block' X0=6 Y0=6 Z0=6 X1=-6 Y1=-6 Z1=-6 MATERIALLABEL='Air' LEVEL=300
FILTER TYPE=BODY
PREVIEW OPTION=PICK | PICK OPTION=ADD PROPERTY=UniqueName LABEL='Block-001'
PREVIEW OPTION=ACCEPT REDISPLAY=NO |  CELLDATA OPTION=MODIFY MATERIALLABEL='Air' POTENTIAL=TOTAL ELEMENTTYPE=Linear LEVEL=300 SIZE=0.5 ELEMSHAPEPREF=NONE

//// Symmetry
BACKGROUND OPTION=LOAD

/++ BACKGROUND OPTION=SET SHAPE=BLOCK SCALEX=2 SCALEY=2 SCALEZ=2   XYSYMMETRYPLANE=NO YZSYMMETRYPLANE=NO ROTZNUM=1 ZXSYMMETRYPLANE=NO

BACKGROUND OPTION=SET SHAPE=BLOCK SCALEX=1 SCALEY=1 SCALEZ=1   XYSYMMETRYPLANE=YES YZSYMMETRYPLANE=YES ROTZNUM=1 ZXSYMMETRYPLANE=YES EMRYZ=TANGMAGN EMRXY=TANGMAGN EMRZX=NORMMAGN



//// Analysis Settings
MULTIPHYSICS OPTION=RESET
DBCASEDATA PROGRAM=ELEKTRATR OPTION=INSERT VALUE=0;30;1 INDEX=1
ANALYSISDATA OPTION=SET PROGRAM=ELEKTRATR DELTAT=1 HX=0 HY=0 HZ=0 LINEAR=NO LOGLIST= LOGLIST+=TTime NITERATIONS=21 NLITERTYPE=NEWTON RHS=ADAPTIVE TOLERANCE=0.001 UPDATE=SIMPLE USEDEFORMEDMESH=NO



//// Create Model Body
MODEL CREATE

MESH GENERATOR=AUTOMATIC SIZE=0.5 NORMALTOL=30.0 SURFACETOL=0.0 TOLERANCE=1.0E-06 TYPE=PREFERTETRA 

FILL TOL=1.0E-06 


//// Create database
SOLVERS ELEMENT=LINEAR,| SOLVERS SOLVENOW=NO SAVEMODEL=YES, | SOLVERS OPTION=TEST FILE='pure_perturbation_AC' UNITS=METRE SURFACE=CURVED | COMMENT CLEAR=YES TYPE=DBTITLE | COMMENT TEXT='Perturbation in vacuum, to test field created at center' | SOLVERS OPTION=OVERWRITE







